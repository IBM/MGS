// =================================================================
// Licensed Materials - Property of IBM
//
// "Restricted Materials of IBM"
//
// BCM-YKT-07-18-2017
//
// (C) Copyright IBM Corp. 2005-2017  All rights reserved
//
// US Government Users Restricted Rights -
// Use, duplication or disclosure restricted by
// GSA ADP Schedule Contract with IBM Corp.
//
// =================================================================

#ifndef GOODWIN_MDL
#define GOODWIN_MDL
#include "../PointNeuronTools/PointNeuronTools.mdl"

Node Goodwin Implements GoodwinProducer
{
  double X;            // mRNA
  double Y;            // protein
  double Z;            // transcriptional inhibitor
  
  Input [] in;         // used by model specific phases

  // Model specific instance variables
  double k5_instance;
  
  Shared
    {
      double K1;
      double k1;
      double k2;
      double k3;
      double k4;
      double k5;
      double k6;
      double n;

      double deltaT;   // in s

      // Model specific shared variables
      double k5min;    // for paramaterizing for CB1R min
      double k5max;    // for paramaterizing for CB1R max
      double k5tau;    // k5 recovery/decay time constant

      // Model specific flags
      bool op_Cannabinoids;
      
      // Model specific shared phases
      InitPhase initializeShared_Cannabinoids_init_k5;
    }

  InAttrPSet
    {
      string identifier;
      double weight;
    }

  InitPhase initialize();
  RuntimePhase update(X, Y, Z);
  
  GoodwinProducer.X << &X;
  GoodwinProducer.Y << &Y;
  GoodwinProducer.Z << &Z;

  UserFunction setInIndices;

  Connection Pre Node (PSet.identifier=="in") Expects OutputProducer
  {
    OutputProducer.output >> in.input;
    PSet.weight >> in.weight;
    setInIndices();
  }
  
}

#endif
