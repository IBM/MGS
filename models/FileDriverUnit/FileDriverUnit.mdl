// =================================================================
// Licensed Materials - Property of IBM
//
// "Restricted Materials of IBM"
//
// BCM-YKT-07-18-2017
//
// (C) Copyright IBM Corp. 2005-2017  All rights reserved
//
// US Government Users Restricted Rights -
// Use, duplication or disclosure restricted by
// GSA ADP Schedule Contract with IBM Corp.
//
// =================================================================

#ifndef FILEDRIVERUNIT_MDL
#define FILEDRIVERUNIT_MDL
#include "../PointNeuronTools/PointNeuronTools.mdl"

Node FileDriverUnit Implements OutputProducer
{
  int channel;              // Channel index from this specific unit
  double output;            // Output for this specific unit

  // Parameters set by the user
  Shared
    {
      string inputFileName; // File to load from
      unsigned n_channels;  // The number of channels in this file
      unsigned total_time;  // Length of data in the file
      //      int offset;           // Offset of file. N.B. user doesn't have to set
      //      int section;          // Section of the file (i.e. sections are delimited by an empty line)
      double sf;            // Sampling frequency of file (i.e. how often to load)
      unsigned period;      // Related to sf, how often to load. N.B. user doesn't have to set
      double scale;         // How much to scale the input by
      double [] input;      // Data read from the file (size=n_channels)

      bool op_random;       // whether channels are assigned to units randomly or sequentially
      
      bool userWarned;      // Whether the user has been warned of EOF
      
      double deltaT;        // in s
     
      InitPhase initializeShared;
      RuntimePhase readInputFile;
    }

  InAttrPSet 
    {
      string identifier;
    }
  
  InitPhase initialize();
  RuntimePhase updateOutput(output);
  
  OutputProducer.output << &output;
  
  UserFunction setIndices;
}

#endif
