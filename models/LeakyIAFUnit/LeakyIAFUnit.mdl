// =============================================================================
// (C) Copyright IBM Corp. 2005-2025. All rights reserved.
//
// Distributed under the terms of the Apache License
// Version 2.0, January 2004.
// (See accompanying file LICENSE or copy at http://www.apache.org/licenses/.)
//
// =============================================================================
#ifndef LEAKYIAFUNIT_MDL
#define LEAKYIAFUNIT_MDL
#include "../PointNeuronTools/PointNeuronTools.mdl"

Node LeakyIAFUnit Implements VoltageIAFProducer, SpikeProducer
{
  SpikeInput [] inputs; // recurrent incoming spikes
  float V;              // membrane potential
  bool spike;           // current spike status
  
  Shared
    {
      double driver;     // common input to all neurons
      double tau;        // leak decay time constant in s
      double threshold;  // spiking threshold
      double deltaT;     // in s
     
      InitPhase initializeShared;
    }

  InAttrPSet 
    {
      string identifier;
      double weight;
    }
  
  InitPhase initialize();  
  RuntimePhase update(V); // only V is chnaged by this phase
  RuntimePhase threshold(spike); // only spike is chnaged by this phase  

  // Setup outgoing connections
  VoltageIAFProducer.voltage << &V; // the voltage output
  SpikeProducer.spike << &spike; // the spike output

  // Setup incoming connections
   Connection Pre Node (PSet.identifier=="recW") Expects SpikeProducer {
     SpikeProducer.spike >> inputs.spike;
     PSet.weight >> inputs.weight;
   }  
  
  UserFunction setIndices;
}

#endif
 
